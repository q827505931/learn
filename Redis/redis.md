### 																							Redis

###### 1.Redis 是什么 使用场景

Redis 是c语言编写的，基于内存操作，一种可持久化的非关系数据库 基于key-value的数据库 主要用在一些要求响应速度的场景，数据结构不固定，存储扩展性高的数据

###### 2.Redis有什么功能

（1）可以做数据缓存，热点数据的存储，减少关系库的压力

（2）可以用Redis的位运算做数据统计 节省空间

（3）可以做分布式锁，setnx

（4）可以利用list做消息队列

（5）取并集交集差集union  diff intersect

###### 3.Redis为什么是单线程的

redis 的最大优势是快，他的快速响应主要是因为首先基于纯内存操作，内存的读写是要显著快于磁盘读写的 再次 Redis是单线程的 减少了线程间切换的开销 最后 他基于通道实现了io多路复用 

它是单线程的主要是因为Redis的瓶颈最大可能是网络带宽和内存速度带来的 不会是cpu的速度 单线程没有意义 还有平白减慢Redis的速度

###### 4.缓存穿透 

缓存穿透是指当查询一个一定不存在的内容时，由于结果为空，每次请求都不会把查询结果缓存到非关系库 导致了每次请求都是直接查询关系库，容易被人恶意攻击 

解决策略 可以将查询结果为空的时候也将空存储到Redis设置一个比较短的过期时间，还可以使用布隆过滤器过滤掉一些非法参数，当同一个ip发来大量非法请求的时候可以考虑禁止该ip访问

###### 5.redis数据类型

redis支持五种数据类型 string list set sortedset hash

###### 6.保证缓存数据的一致性

当发生增删改操作后清除掉redis中的相关数据

合理设置过期时间

###### 7.redis持久化方式

RDB(Redis DataBase) 指定的时间间隔对数据进行快照存储 操作流程大致如下 当符合rdb策略或者显式的执行bgsave命令时，会fork一个子进程，子进程将当前数据写入临时的rdb文件，写入完成之后删除将临时的rdb文件替换未原来的rdb文件，rdb是个紧凑的数据文件，非常适合做数据传输，以及备份，多个节点集群环境的全量同步就是通过传输rdb文件实现的 并且在数据量很大的时候rdb文件的恢复速度很快的 缺点更新不及时 有可能造成数据丢失  每次fork子进程需要将全部数据写入rdb文件，耗时且影响性能

AOF(append only file) 每次命令操作之后都会将当前命令追加到aof文件中

缺点在于恢复大文件时间速度较慢，不适合做容灾备份 set和delete之后为空 这两条命令就是无效的 自己内部有重建数据集的机制 优点在于效率高 不会造成数据丢失

###### 8.redis 实现分布式锁

redis实现分布式锁主要是通过setnx命令实现的 setnx 类似于占坑 当一个线程需要使用锁时会去设置值 设置成功代表他可以占有锁开始执行，设置不成功只能等待 使用完删除 这样其他县城就可以获取锁了

###### 9.redis分布式锁的缺点

首先锁要给一个过期时间  setnx 与设置过期时间不是一个原子操作，中间出现异常可能会导致锁永不过期 可以采用set 方法中指定过期时间

有可能会释放别的线程的锁

set（key ,当前线程ID ） 如果两者相等才会去释放锁

###### 10.内存优化 

对于复杂数据尽可能使用hash数据类型 hash 类型使用的内存空间很少 考虑将数据模型抽象成散列表

###### 11.淘汰策略

no-enviction 当内存满了 禁止驱逐

volitile-lru 从已设置过期时间的key移除一个最少使用的

volitile-ttl 移除一个快要过期的key

volitile-random 在所有设置了过期时间的key中随机移除一个

allkeys-lru 从所有键中移除一个最少使用的

allkeys-random 从所有key中随机移除一个

###### 12.缓存雪崩

当大量的key在一段时间内同时过期，大量的请求直接到达数据库，可能会直接压垮数据库，造成数据库宕机 解决策略 双缓存机制 不同的类型商品设置不同的过期时间 同一商品下设置随机的过期时间

###### 13.缓存击穿

某个热点key 一直扛着高并发访问，结果某一时间key过期了，大量的请求会直接访问数据库给数据库带来很大的压力  解决策略 热点key永不过期